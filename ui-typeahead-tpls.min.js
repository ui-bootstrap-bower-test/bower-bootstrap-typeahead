angular.module("ui.bootstrap.typeahead",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).factory("typeaheadParser",["$parse",function(e){var t=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(a){var i=a.match(t);if(!i)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+a+'".');return{itemName:i[3],source:e(i[4]),viewMapper:e(i[2]||i[1]),modelMapper:e(i[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function(e,t,a,i,n,p,o){var c=[9,13,27,38,40];return{require:"ngModel",link:function(r,l,d,h){var s,u=r.$eval(d.typeaheadMinLength)||1,m=r.$eval(d.typeaheadWaitMs)||0,f=r.$eval(d.typeaheadEditable)!==!1,y=t(d.typeaheadLoading).assign||angular.noop,v=t(d.typeaheadOnSelect),$=d.typeaheadInputFormatter?t(d.typeaheadInputFormatter):void 0,g=d.typeaheadAppendToBody?t(d.typeaheadAppendToBody):!1,x=t(d.ngModel).assign,b=o.parse(d.typeahead),w=angular.element("<div typeahead-popup></div>");w.attr({matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"}),angular.isDefined(d.typeaheadTemplateUrl)&&w.attr("template-url",d.typeaheadTemplateUrl);var M=r.$new();r.$on("$destroy",function(){M.$destroy()});var I=function(){M.matches=[],M.activeIdx=-1},q=function(e){var t={$viewValue:e};y(r,!0),a.when(b.source(r,t)).then(function(a){if(e===h.$viewValue&&s){if(a.length>0){M.activeIdx=0,M.matches.length=0;for(var i=0;i<a.length;i++)t[b.itemName]=a[i],M.matches.push({label:b.viewMapper(M,t),model:a[i]});M.query=e,M.position=g?p.offset(l):p.position(l),M.position.top=M.position.top+l.prop("offsetHeight")}else I();y(r,!1)}},function(){I(),y(r,!1)})};I(),M.query=void 0;var k;h.$parsers.unshift(function(e){return s=!0,e&&e.length>=u?m>0?(k&&i.cancel(k),k=i(function(){q(e)},m)):q(e):(y(r,!1),I()),f?e:e?void h.$setValidity("editable",!1):(h.$setValidity("editable",!0),e)}),h.$formatters.push(function(e){var t,a,i={};return $?(i.$model=e,$(r,i)):(i[b.itemName]=e,t=b.viewMapper(r,i),i[b.itemName]=void 0,a=b.viewMapper(r,i),t!==a?t:e)}),M.select=function(e){var t,a,i={};i[b.itemName]=a=M.matches[e].model,t=b.modelMapper(r,i),x(r,t),h.$setValidity("editable",!0),v(r,{$item:a,$model:t,$label:b.viewMapper(r,i)}),I(),l[0].focus()},l.bind("keydown",function(e){0!==M.matches.length&&-1!==c.indexOf(e.which)&&(e.preventDefault(),40===e.which?(M.activeIdx=(M.activeIdx+1)%M.matches.length,M.$digest()):38===e.which?(M.activeIdx=(M.activeIdx?M.activeIdx:M.matches.length)-1,M.$digest()):13===e.which||9===e.which?M.$apply(function(){M.select(M.activeIdx)}):27===e.which&&(e.stopPropagation(),I(),M.$digest()))}),l.bind("blur",function(){s=!1});var A=function(e){l[0]!==e.target&&(I(),M.$digest())};n.bind("click",A),r.$on("$destroy",function(){n.unbind("click",A)});var _=e(w)(M);g?n.find("body").append(_):l.after(_)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(e,t,a){e.templateUrl=a.templateUrl,e.isOpen=function(){return e.matches.length>0},e.isActive=function(t){return e.active==t},e.selectActive=function(t){e.active=t},e.selectMatch=function(t){e.select({activeIdx:t})}}}}).directive("typeaheadMatch",["$http","$templateCache","$compile","$parse",function(e,t,a,i){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(n,p,o){var c=i(o.templateUrl)(n.$parent)||"template/typeahead/typeahead-match.html";e.get(c,{cache:t}).success(function(e){p.replaceWith(a(e.trim())(n))})}}}]).filter("typeaheadHighlight",function(){function e(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,a){return a?t.replace(new RegExp(e(a),"gi"),"<strong>$&</strong>"):t}}),angular.module("template/typeahead/typeahead-match.html",[]).run(["$templateCache",function(e){e.put("template/typeahead/typeahead-match.html",'<a tabindex="-1" bind-html-unsafe="match.label | typeaheadHighlight:query"></a>')}]),angular.module("template/typeahead/typeahead-popup.html",[]).run(["$templateCache",function(e){e.put("template/typeahead/typeahead-popup.html",'<ul class="dropdown-menu" ng-style="{display: isOpen()&&\'block\' || \'none\', top: position.top+\'px\', left: position.left+\'px\'}"><li ng-repeat="match in matches" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)"><div typeahead-match="" index="$index" match="match" query="query" template-url="templateUrl"></div></li></ul>')}]);