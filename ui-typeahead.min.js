angular.module("ui.bootstrap.typeahead",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).factory("typeaheadParser",["$parse",function(e){var t=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(a){var i=a.match(t);if(!i)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+a+'".');return{itemName:i[3],source:e(i[4]),viewMapper:e(i[2]||i[1]),modelMapper:e(i[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function(e,t,a,i,n,r,o){var c=[9,13,27,38,40];return{require:"ngModel",link:function(p,l,d,s){var u,h=p.$eval(d.typeaheadMinLength)||1,m=p.$eval(d.typeaheadWaitMs)||0,f=p.$eval(d.typeaheadEditable)!==!1,v=t(d.typeaheadLoading).assign||angular.noop,y=t(d.typeaheadOnSelect),$=d.typeaheadInputFormatter?t(d.typeaheadInputFormatter):void 0,g=d.typeaheadAppendToBody?t(d.typeaheadAppendToBody):!1,w=t(d.ngModel).assign,b=o.parse(d.typeahead),x=angular.element("<div typeahead-popup></div>");x.attr({matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position"}),angular.isDefined(d.typeaheadTemplateUrl)&&x.attr("template-url",d.typeaheadTemplateUrl);var I=p.$new();p.$on("$destroy",function(){I.$destroy()});var M=function(){I.matches=[],I.activeIdx=-1},q=function(e){var t={$viewValue:e};v(p,!0),a.when(b.source(p,t)).then(function(a){if(e===s.$viewValue&&u){if(a.length>0){I.activeIdx=0,I.matches.length=0;for(var i=0;i<a.length;i++)t[b.itemName]=a[i],I.matches.push({label:b.viewMapper(I,t),model:a[i]});I.query=e,I.position=g?r.offset(l):r.position(l),I.position.top=I.position.top+l.prop("offsetHeight")}else M();v(p,!1)}},function(){M(),v(p,!1)})};M(),I.query=void 0;var _;s.$parsers.unshift(function(e){return u=!0,e&&e.length>=h?m>0?(_&&i.cancel(_),_=i(function(){q(e)},m)):q(e):(v(p,!1),M()),f?e:e?void s.$setValidity("editable",!1):(s.$setValidity("editable",!0),e)}),s.$formatters.push(function(e){var t,a,i={};return $?(i.$model=e,$(p,i)):(i[b.itemName]=e,t=b.viewMapper(p,i),i[b.itemName]=void 0,a=b.viewMapper(p,i),t!==a?t:e)}),I.select=function(e){var t,a,i={};i[b.itemName]=a=I.matches[e].model,t=b.modelMapper(p,i),w(p,t),s.$setValidity("editable",!0),y(p,{$item:a,$model:t,$label:b.viewMapper(p,i)}),M(),l[0].focus()},l.bind("keydown",function(e){0!==I.matches.length&&-1!==c.indexOf(e.which)&&(e.preventDefault(),40===e.which?(I.activeIdx=(I.activeIdx+1)%I.matches.length,I.$digest()):38===e.which?(I.activeIdx=(I.activeIdx?I.activeIdx:I.matches.length)-1,I.$digest()):13===e.which||9===e.which?I.$apply(function(){I.select(I.activeIdx)}):27===e.which&&(e.stopPropagation(),M(),I.$digest()))}),l.bind("blur",function(){u=!1});var k=function(e){l[0]!==e.target&&(M(),I.$digest())};n.bind("click",k),p.$on("$destroy",function(){n.unbind("click",k)});var A=e(x)(I);g?n.find("body").append(A):l.after(A)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(e,t,a){e.templateUrl=a.templateUrl,e.isOpen=function(){return e.matches.length>0},e.isActive=function(t){return e.active==t},e.selectActive=function(t){e.active=t},e.selectMatch=function(t){e.select({activeIdx:t})}}}}).directive("typeaheadMatch",["$http","$templateCache","$compile","$parse",function(e,t,a,i){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(n,r,o){var c=i(o.templateUrl)(n.$parent)||"template/typeahead/typeahead-match.html";e.get(c,{cache:t}).success(function(e){r.replaceWith(a(e.trim())(n))})}}}]).filter("typeaheadHighlight",function(){function e(e){return e.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(t,a){return a?t.replace(new RegExp(e(a),"gi"),"<strong>$&</strong>"):t}});